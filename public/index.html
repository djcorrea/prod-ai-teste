<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AI.SYNTH - Mentor Virtual</title>
    <link rel="stylesheet" href="style.css">
    <link rel="stylesheet" href="audio-analyzer.css">
    <link rel="stylesheet" href="music-button-below-chat.css">
    
    <!-- Fontes otimizadas -->
    <link href="https://fonts.googleapis.com/css2?family=Orbitron:wght@400;700;900&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    
    <!-- Bibliotecas para efeitos visuais -->
    <!-- Otimizado: Adicionado defer para n√£o bloquear parsing -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/vanta/0.5.24/vanta.net.min.js" defer></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js" defer></script>

    <!-- Firebase e Scripts funcionais -->
    <script type="module" src="firebase.js"></script>
    <script src="auth.js" defer></script>
</head>
<body>
    <!-- Fundo animado 3D -->
    <div class="cenario">
        <!-- Container para o fundo animado Vanta.js -->
        <div class="vanta-background" id="vanta-bg"></div>
        
        <!-- Plano de fundo com rede neural (mantido como fallback) -->
        <img src="fundo.webp" alt="Fundo futurista" class="fundo" />

        <!-- Elementos do cen√°rio -->
        <!-- üö® POSS√çVEL OTIMIZA√á√ÉO: 
             Verificar se todas essas imagens s√£o realmente necess√°rias
             M√∫ltiplas imagens grandes podem causar overhead de mem√≥ria -->
        <img src="robo.webp" alt="Rob√¥ futurista" class="robo fade-in-start" />
        <img src="mesa.webp" alt="Mesa" class="mesa fade-in-start" />
        <img src="caixas.webp" alt="Caixas de som principais" class="caixas fade-in-start" />
        <img src="notebook.webp" alt="Notebook" class="notebook fade-in-start" />
        <img src="teclado.webp" alt="teclado" class="teclado fade-in-start" />
        
        <!-- Overlay de part√≠culas extras -->
        <!-- üö® GARGALO: Div vazia que pode estar sendo usada para gerar part√≠culas CSS
             Pode estar causando renderiza√ß√µes extras -->
        <div class="particles-overlay fade-in-start"></div>
    </div>

    <!-- Chatbot posicionado no monitor -->
    <div class="chatbot-container" id="chatbotContainer">
        <!-- Estado Inicial (Welcome) -->
        <div class="chatbot-welcome-state" id="chatbotWelcomeState">
            <div class="chatbot-robot-wrapper">
                <img src="robo 2.webp" alt="AI.SYNTH Robot" class="chatbot-main-robot" id="chatbotMainRobot">
            </div>
            
            <div class="chatbot-branding" id="chatbotBranding">
                <h1 class="chatbot-main-title" id="chatbotMainTitle">AI.SYNTH</h1>
                <p class="chatbot-main-subtitle" id="chatbotMainSubtitle">Seu mentor virtual</p>
            </div>
            
            <div class="chatbot-input-section" id="chatbotInputSection">
                <div class="chatbot-input-field">
                    <svg class="chatbot-mic-icon" width="20" height="20" viewBox="0 0 384 512" fill="currentColor">
                        <path d="M192 0C139 0 96 43 96 96v160c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96zM64 216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 89.1 66.2 162.7 152 174.4V464h-48c-13.3 0-24 10.7-24 24s10.7 24 24 24h144c13.3 0 24-10.7 24-24s-10.7-24-24-24h-48v-33.6c85.8-11.7 152-85.3 152-174.4v-40c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 70.7-57.3 128-128 128s-128-57.3-128-128V216z"/>
                    </svg>
                    <input type="text" 
                           class="chatbot-main-input" 
                           id="chatbotMainInput" 
                           placeholder="Digite aqui..."
                           maxlength="500">
                    <button class="chatbot-send-button" id="chatbotSendButton">
                        <svg width="24" height="24" viewBox="0 0 24 24" fill="none">
                            <path d="M2 21L23 12L2 3V10L17 12L2 14V21Z" fill="white" stroke="none"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
        
        <!-- Estado Ativo (Chat) -->
        <div class="chatbot-active-state" id="chatbotActiveState">
            <div class="chatbot-header-bar" id="chatbotHeaderBar">
                <div class="chatbot-header-centered">
                    <div class="chatbot-header-text">
                        <span class="chatbot-header-name">AI.SYNTH</span>
                        <span class="chatbot-header-desc">Seu mentor virtual</span>
                    </div>
                </div>
            </div>
            
            <div class="chatbot-conversation-area" id="chatbotConversationArea">
                <!-- As mensagens ser√£o inseridas aqui dinamicamente -->
            </div>
            
            <div class="chatbot-input-area">
                <div class="chatbot-typing-indicator" id="chatbotTypingIndicator">
                    <span></span>
                    <span></span>
                    <span></span>
                </div>
                <div class="chatbot-active-input-field">
                    <svg class="chatbot-mic-icon" width="20" height="20" viewBox="0 0 384 512" fill="currentColor">
                        <path d="M192 0C139 0 96 43 96 96v160c0 53 43 96 96 96s96-43 96-96V96c0-53-43-96-96-96zM64 216c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 89.1 66.2 162.7 152 174.4V464h-48c-13.3 0-24 10.7-24 24s10.7 24 24 24h144c13.3 0 24-10.7 24-24s-10.7-24-24-24h-48v-33.6c85.8-11.7 152-85.3 152-174.4v-40c0-13.3-10.7-24-24-24s-24 10.7-24 24v40c0 70.7-57.3 128-128 128s-128-57.3-128-128V216z"/>
                    </svg>
                    <input type="text" 
                           class="chatbot-active-input" 
                           id="chatbotActiveInput" 
                           placeholder="Digite sua mensagem..."
                           maxlength="500">
                    <button class="chatbot-active-send-btn" id="chatbotActiveSendBtn">
                        <svg width="22" height="22" viewBox="0 0 24 24" fill="none">
                            <path d="M2 21L23 12L2 3V10L17 12L2 14V21Z" fill="white" stroke="none"/>
                        </svg>
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- üéµ BOT√ÉO DE AN√ÅLISE DE M√öSICA - Posicionado abaixo do chat -->
    <div class="music-analysis-section" style="
        position: fixed;
        top: 680px;
        left: 50%;
        transform: translateX(-50%);
        z-index: 1000;
        width: 800px;
        max-width: 90vw;
        display: flex;
        justify-content: center;
        padding-top: 20px;
        box-sizing: border-box;
    ">
        <button class="music-analysis-btn" onclick="openAudioModal()" id="musicAnalysisBtn" style="
            background: linear-gradient(135deg, rgba(0, 150, 255, 0.2), rgba(100, 200, 255, 0.15));
            border: 1px solid rgba(0, 150, 255, 0.4);
            border-radius: 20px;
            padding: 8px 16px;
            color: rgba(255, 255, 255, 0.9);
            font-family: 'Poppins', sans-serif;
            font-size: 0.8rem;
            font-weight: 500;
            cursor: pointer;
            backdrop-filter: blur(15px);
            box-shadow: 0 4px 15px rgba(0, 150, 255, 0.2);
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            min-height: 44px;
            min-width: 120px;
            touch-action: manipulation;
            -webkit-tap-highlight-color: rgba(0, 150, 255, 0.2);
            user-select: none;
            box-sizing: border-box;
        ">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="currentColor">
                <path d="M3 9v6h4l5 5V4L7 9H3zm13.5 3c0-1.77-1.02-3.29-2.5-4.03v8.05c1.48-.73 2.5-2.25 2.5-4.02zM14 3.23v2.06c2.89.86 5 3.54 5 6.71s-2.11 5.85-5 6.71v2.06c4.01-.91 7-4.49 7-8.77s-2.99-7.86-7-8.77z"/>
            </svg>
            <span>An√°lise de M√∫sica</span>
        </button>
    </div>

    <!-- Bot√µes de a√ß√£o do chatbot -->
    <div class="chatbot-action-buttons">
        <button class="chatbot-action-btn" data-action="upgrade">
            <span>Assinar vers√£o Plus</span>
        </button>
        <button class="chatbot-action-btn" data-action="manage">
            <span>Gerenciar conta</span>
        </button>
        <button class="chatbot-action-btn" data-action="logout">
            <span>Sair</span>
        </button>
    </div>

    <!-- üéµ MODAL DE AN√ÅLISE DE √ÅUDIO -->
    <div id="audioAnalysisModal" class="audio-modal" style="display: none;">
        <div class="audio-modal-content">
            <div class="audio-modal-header">
                <h3>üéµ An√°lise de √Åudio</h3>
                <button class="audio-modal-close" onclick="closeAudioModal()">&times;</button>
            </div>
            
            <!-- Upload Area -->
            <div class="audio-upload-area" id="audioUploadArea">
                <div class="upload-content">
                    <div class="upload-icon">üéµ</div>
                    <h4>Analisar seu √°udio</h4>
                    <p>Arraste seu arquivo aqui ou clique para selecionar</p>
                    <p class="supported-formats">Suporta: MP3, WAV, M4A, OGG (m√°x. 10MB)</p>
                    <input type="file" id="modalAudioFileInput" 
                           accept="audio/mp3,audio/wav,audio/mpeg,audio/mp4,audio/m4a,audio/aac,audio/ogg,audio/webm,.mp3,.wav,.m4a,.aac,.ogg,.webm" 
                           style="position:absolute;left:-9999px;opacity:0;width:1px;height:1px;" tabindex="-1">
                    <label for="modalAudioFileInput"
                        class="upload-btn"
                        style="touch-action: manipulation; -webkit-tap-highlight-color: rgba(0, 150, 255, 0.3); width:100%; pointer-events:auto; display:inline-block; text-align:center; cursor:pointer;">
                        Escolher Arquivo
                    </label>
                </div>
            </div>

            <!-- Loading -->
            <div id="audioAnalysisLoading" class="audio-loading" style="display: none;">
                <div class="loading-spinner"></div>
                <p id="audioProgressText">Analisando √°udio...</p>
                <div class="progress-bar">
                    <div class="progress-fill" id="audioProgressFill"></div>
                </div>
            </div>

            <!-- Results -->
            <div id="audioAnalysisResults" class="audio-results" style="display: none;">
                <div class="results-header">
                    <h4>üî¨ An√°lise Completa</h4>
                </div>
                
                <div class="technical-data" id="modalTechnicalData">
                    <!-- Dados t√©cnicos ser√£o inseridos aqui -->
                </div>

                <div class="analysis-actions">
                    <button class="action-btn primary" onclick="sendModalAnalysisToChat()">
                        ü§ñ Pedir Ajuda √† IA
                    </button>
                    <button class="action-btn secondary" onclick="downloadModalAnalysis()">
                        üìÑ Baixar Relat√≥rio
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Script integrado com as funcionalidades existentes -->
    <!-- Otimizado: Removido cache busting desnecess√°rio para melhor cache -->
    <script src="script.js" defer></script>
    
    <!-- üé§ VOICE MESSAGE SIMPLE - PROD.AI -->
        <script src="voice-clean.js" defer></script>
    
    <!-- üéµ AUDIO ANALYZER - Carregar os scripts -->
    <script src="audio-analyzer.js" defer></script>
    <script src="audio-analyzer-integration.js" defer></script>
    
    <!-- Inicializar Audio Analyzer -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Aguardar um pouco para garantir que todos os scripts carregaram
            setTimeout(() => {
                if (typeof initializeAudioAnalyzerIntegration === 'function') {
                    initializeAudioAnalyzerIntegration();
                    console.log('üéµ Audio Analyzer Integration inicializado');
                } else {
                    console.warn('‚ö†Ô∏è initializeAudioAnalyzerIntegration n√£o encontrada');
                }
            }, 1000);
        });
    </script>
    
    <!-- Scripts de monitoramento desabilitados para performance -->
    <!-- <script src="plan-monitor.js"></script> -->
    <!-- <script src="force-visibility.js"></script> -->
    <script src="plan-monitor.js"></script>
    <script src="force-visibility.js"></script>
</body>
</html>